name: "LLM Log Analyzer"
description: "Analyzes pipeline logs using a locally hosted LLM model"
author: "Rahul G S"

inputs:
  llm_script_path:
    description: "Path to the Python script for log analysis"
    required: false
    default: "C:/rahul/llm/llm-test.py"
  logs_pattern:
    description: "Glob pattern for logs to include"
    required: false
    default: "*.log"

runs:
  using: "composite"
  steps:
    - name: Find and Combine Logs
      shell: powershell
      run: |
        Write-Host "ðŸ“„ Searching for logs matching pattern: ${{ inputs.logs_pattern }}"
        New-Item -ItemType Directory -Force -Path combined_logs | Out-Null
        $logFiles = Get-ChildItem -Recurse -Filter "${{ inputs.logs_pattern }}"
        if ($logFiles.Count -eq 0) {
          Write-Host "No log files found."
        } else {
          $logFiles | ForEach-Object {
            Write-Host "Adding log: $($_.FullName)"
            Get-Content $_.FullName | Add-Content combined_logs/full_pipeline.log
          }
          Write-Host "Combined log saved to combined_logs/full_pipeline.log"
        }

    - name: ðŸ§  Run Local LLM Analyzer
      shell: powershell
      run: |
        Write-Host "Running local LLM analyzer..."
        python "${{ inputs.llm_script_path }}" combined_logs/full_pipeline.log > combined_logs/llm_output.json
        Write-Host "LLM Analysis Result:"
        Get-Content combined_logs/llm_output.json
